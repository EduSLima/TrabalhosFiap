---
title: "ANALISE DO DATASET WINE QUALITY"
output: html_notebook
---

###  **"Conceitos Estatísticos para IA"**  
####  *Prof. Adelaide Alves de Oliveira*

<br/>

* TURMA: FIAP-06IA
  + EDUARDO MORARES
  + EDUARDO SIQUEIRA DE LIMA
  + GABRIEL SHIKAMA
  + RICARDO KALIMANIS

<br/><br/>
Inicicalmente vamos instalar os pacotes, caso seja necessário, que serão usados no decorrer da análise
```{r}

#ignorando alertas para não poluir a exibição do markdwon
options(warn =-1)

#lista de pacotes que iremos utilizar no projeto
Pacotes_Necessarios <- c("ggplot2","readr","dplyr", "corrgram","corrplot", "plotly","skimr","gridExtra","GGally")

#com base nos pacotes instalados crio uma variavel somente com os pacotes que não temos ainda para realizar a instalação 
#dos pacotes que de fato não possuimos
PacotesNovos <- Pacotes_Necessarios[!(Pacotes_Necessarios %in% installed.packages()[,"Package"])]
if(length(PacotesNovos)){ install.packages(PacotesNovos)} else {print("Todos os Pacotes Estão Instalados")}

```



Carregando todas as as Bibliotecas mencionadas no passo anterior
```{r, results="hide"}
lapply(Pacotes_Necessarios, require, character.only = TRUE)
```



Importando os Datasets de Wines Quality.


#### Lista DE - PARA das colunas



Nome no Arquivo     |  Nome Traduzido
----------------    |-----------------
ID                  |ID (que não sera utilizado)
fixed acidity       |acidez_fixa
volatile acidity    |acidez_volatil
citric acid         |acido_citrico	
residual sugar      |acucar_residual
chlorides           |cloretos
free sulfur dioxide |fsd
total sulfur dioxide|tsd
density             |densidade
pH                  |PH
sulphates           |sulfatos
alcohol             |grau_alcolico
quality             |qualidade
Vinho               |Tipo


```{r, results="hide"}

#Criando uma variável nome_colunas que receberá os nomes das colunas que normalizaremos a fim de facilitar o resto da análise
nome_colunas <- c("id","acidez_fixa","acidez_volatil","acido_citrico","acucar_residual","cloretos", "fsd", "tsd","densidade","PH", "sulfatos","grau_alcolico","qualidade","tipo")

#uso da biblioteca readr é para obter uma performance de carga melhor que a lib padrão do R
#e escolhemos o read_csv2 justamente pelo fato do arquivo estar separado por ; ao invés de ,
#o separador decimal também não é o . que é convencional e este comando ja os converte facilmente
#skip = 1 para ignorar o cabecalho que mudamos para melhor entendimento
vinhos <- read_csv2("./DataSets/BaseWine_Red_e_White.csv" ,col_names = nome_colunas, skip = 1)


```


Adicionando uma classificação de bom ou ruim de acordo com sua nota, onde menor que 5 é ruim até 7 bom e acima disso excelentte

```{r}

#converte tipo paara fator
vinhos$tipo <- factor(vinhos$tipo, ordered = T)

#Criando uma coluna de Ranking para dizer o quão bom é o vinho
vinhos$rating <- factor(ifelse(vinhos$qualidade <= 5, 'Ruim', ifelse(vinhos$qualidade <= 7, 'Bom', 'Excelente')))

```



Exibindo os dados das dimensões, sumário, estrutura e as primeiras linhas do DataFrame Vinhos

```{r ,results="hide"}

attach(vinhos)

```

```{r}
#demonstrando as quantidades de dimensoes de ambos datasets

dim(vinhos)
skim(vinhos)
str(vinhos)
head (vinhos,3)

```


Distribuição da Qualidade do Vinho por tipo de vinho e classificação

```{r}

grafico_1 <- qplot(qualidade, data = vinhos, fill = tipo, binwidth = 1)  
grafico_2 <- qplot(qualidade, data = vinhos, fill = rating, binwidth = 1) 

grid.arrange(grafico_1, grafico_2, ncol=2)

```


Observa-se que as qualidades dos vinhos se encontram em uma distribuição normal. Sabe-se que a maior concentração de notas está na regão entre nota 4 e 8. Entretando, antes de aprofundarmos em qualquer análise que envolvem os dados é necessário pontuar se há existencia de outliers e remove-los caso existam

O comando aplicado para todos atributos abaixo exibição dos box-plot abaixo foi:
> *boxplot(Column_Name, col="slategray2", pch=19) * <br />
> *mtext("Titulo" , cex=0.8, side=1, line=2)*

```{r, , echo=FALSE}

par(mfrow=c(1,6), oma = c(1,1,0,0) + 0.1,  mar = c(3,3,1,1) + 0.1)
  boxplot(acidez_fixa, col="slategray2", pch=19)
  mtext("Acidez Fixa" , cex=0.8, side=1, line=2)
  boxplot(acidez_volatil, col="slategray2", pch=19)
  mtext("Acidez Volatil", cex=0.8, side=1, line=2)
  boxplot(acido_citrico, col="slategray2", pch=19)
  mtext("acido_citrico", cex=0.8, side=1, line=2)
  boxplot(acucar_residual, col="slategray2", pch=19)
  mtext("acucar_residual", cex=0.8, side=1, line=2)
  boxplot(cloretos, col="slategray2", pch=19)
  mtext("cloretos", cex=0.8, side=1, line=2)
  boxplot(fsd, col="slategray2", pch=19)
  mtext("fsd", cex=0.8, side=1, line=2)
  
  

```



```{r, , echo=FALSE}

par(mfrow=c(1,5), oma = c(1,1,0,0) + 0.1,  mar = c(3,3,1,1) + 0.1)
  boxplot(tsd, col="slategray2", pch=19)
  mtext("tsd" , cex=0.8, side=1, line=2)
  boxplot(densidade, col="slategray2", pch=19)
  mtext("densidade", cex=0.8, side=1, line=2)
  boxplot(PH, col="slategray2", pch=19)
  mtext("PH", cex=0.8, side=1, line=2)
  boxplot(sulfatos, col="slategray2", pch=19)
  mtext("sulfatos", cex=0.8, side=1, line=2)
  boxplot(grau_alcolico, col="slategray2", pch=19)
  mtext("grau_alcolico", cex=0.8, side=1, line=2)
  
```

Nota se que quase  todas as variáveis possuem outliers e para uma melhor acurácia no modelo iremos removê-las da análise.
O Metodo mais indicado para remoção dos outliers é amplitude interquartil (IQR - InterQuantile Range) onde:
  *IQR  = Q3(quartil 3) - Q1(quartil 1)
Com o IQR calculado é necessário definir o limite inferior e superior que é dado pela seguinte formula:

  $$Lim_{Sup} = \bar{X} + 1,5  * IQR$$
  
  $$Lim_{Inf} = \bar{X} - 1,5  * IQR$$

Para elucidar a aplicação do método vamos analisar a variavel **"Acidez Volátil"** notamos que há muitos valores acima do Q3 a uns poucos abaixo de Q1, Oserve o sumário desta variavel

```{r }

  skim(acidez_volatil)

  #dado p25(Q1) = 0.23 e p75(Q3) = 0.4 temos:
  IQR_Acidez_Volatil =0.4 -0.23
  
  #como resultado temos 1.3 
  #com isso podemos definir os limites superior e inferior do range
  LS_Acidez_Volatil = 0.4 +1.5 * IQR_Acidez_Volatil
  LI_Acidez_Volatil = 0.23 -(1.5 * IQR_Acidez_Volatil)
  
  #temos um limite superior de -0.025 e inferior de 0.655 onde as observações acima ou abaixo desses fatores serão consideradas outilers
  #com base nos limites encontrados farei um sub set do conjunto origi nal de dados levando em consideracao os limites encontrados
  Vinhos_Normalizado <-filter(vinhos, acidez_volatil >= LI_Acidez_Volatil & acidez_volatil <= LS_Acidez_Volatil)
  
  #comparando os resultados
  par(mfrow=c(1,2), oma = c(1,1,0,0) + 0.1,  mar = c(3,3,1,1) + 0.1)
    boxplot(acidez_volatil, col="slategray2", pch=19)
    mtext("Antes" , cex=0.8, side=1, line=2)
    boxplot(Vinhos_Normalizado$acidez_volatil, col="slategray2", pch=19)
    mtext("Depois" , cex=0.8, side=1, line=2)

  
```

De modo que a remoção dos outliers fez com que a distribuição dos dados ficasse mais homogenea como demonstro nos histrogramas a seguir

```{r }

  #comparando os resultados
  par(mfrow=c(1,2), oma = c(1,1,0,0) + 0.1,  mar = c(3,3,1,1) + 0.1)
    hist(acidez_volatil, col="slategray2", main = "")
    mtext("Antes" , cex=0.8, side=1, line=2)
    hist(Vinhos_Normalizado$acidez_volatil, col="slategray2", main = "")
    mtext("Depois" , cex=0.8, side=1, line=2)

```


Para automatizar o processo de analise e remoção dos outliers criamos uma função para executar essa tarefa, e segue:

```{r , results="hide"}

#criando uma funcao para remover os outliers das colunas 
remove_outliers <- function(x, na.rm = TRUE, ...) {
  qnt <- quantile(x, probs=c(.25, .75), na.rm = na.rm, ...)
  H <- 1.5 * IQR(x, na.rm = na.rm)
  y <- x
  y[x < (qnt[1] - H)] <- NA
  y[x > (qnt[2] + H)] <- NA
  y
}

vinhos$acidez_fixa <- remove_outliers(acidez_fixa, T)
teste <- remove_outliers(acidez_volatil)
vinhos$acido_citrico <- remove_outliers(acido_citrico, T)
vinhos$acucar_residual <- remove_outliers(acucar_residual, T)
vinhos$cloretos <- remove_outliers(cloretos, T)
vinhos$fsd <- remove_outliers(fsd, T)
vinhos$tsd <- remove_outliers(tsd, T)
vinhos$densidade <- remove_outliers(densidade, T)
vinhos$PH <- remove_outliers(PH, T)
vinhos$sulfatos <- remove_outliers(sulfatos, T)
vinhos$grau_alcolico <- remove_outliers(grau_alcolico, T)
vinhos$qualidade <- remove_outliers(qualidade, T)

```

Examinando os dados pos limpeza dos outliers

```{r}

par(mfrow=c(1,2), oma = c(1,1,0,0) + 0.1,  mar = c(3,3,1,1) + 0.1)
  boxplot(acidez_volatil, col="slategray2", pch=19)
  mtext("Acidez Volatil", cex=0.8, side=1, line=2)
  boxplot(teste, col="slategray2", pch=19)
  mtext("teste", cex=0.8, side=1, line=2)
  
  
  
```